---
editor_options:
  markdown:
    wrap: 72
---

# Life Expectancy Analysis

For Regression Analysis Course, IPB University 2023, our team members:

-   Raihan Akbar
    ([\@RaihanAkbar-math](https://github.com/RaihanAkbar-math))
-   Daffa Firdaus ([\@daffirds](https://github.com/daffirds))
-   Anisa Nurhajiza

```{r}
# libraries
library(readxl)
library(corrplot)
library(knitr)
library(nortest)
library(car)
library(nortest)
library(lmtest)
library(olsrr)
```

### Data Import

```{r}
data <- read_excel("../data/west-java-life-expectancy-2024.xlsx", skip = 1)[,-1]
data
```

### Data Exploration

```{r}
str(data) #data types
dim(data) #data dimension
summary(data) #data summary
colSums(is.na(data)) #check missing data
```

### Correlation Analysis

```{r}
# correlation table
corr <- round(cor(data),4)
corr[upper.tri(corr)] <- ""
kable(corr, align = "c")

# plot
plot(data, pch = 21)

# heat plot
corrplot(cor(data), type="upper")
```

### All variable Regression

```{r}
model<-lm(Y ~ ., data = data)
model

anova(model)

summary(model)
```

$\text{p-value} = 0.0001567 < 0.05$ so $H_0$ rejected.

### Best model selection

#### Best model for each variable size

```{r}
ols_step_best_subset(model)
```

#### Backward selection

```{r}
ols_step_backward_p(model, details = TRUE)
```

The best model is selected based on the highest R-squared value.
Therefore, we chose **Model index 3** which uses the variables
$X_3,X_4,X_6$ as the best model.

```{r}
model3 <- lm(Y ~ X3+X4+X6, data = data) #best model
```

### Model Assumptions

```{r}
# Assumption exploration
plot(model3,1)                # residuals vs fitted
plot(model3,2)                # qq-plot
plot(x = 1:dim(data)[1],
     y = model3$residuals,
     type = 'b', 
     ylab = "Residuals",
     xlab = "Observation")       # residuals vs obs
```

#### Normality test

```{r}
lillie.test(model3$residuals) #Kolmogorov-Smirnov test
```

**Hypotheses**

$H_0$: The residuals are normally distributed.

$H_1$: The residuals are not normally distributed.

Significance level = 0.05

Test statistic: p-value = 0.1865

Decision: Since the p-value (0.1865) \> $\alpha$ (0.05), we fail to
reject $H_0$.

Conclusion: At the 95% confidence level, we conclude that the residuals
are normally distributed.

#### Multicollinearity test

```{r}
vif(model3)

```

All 3 variables have VIF values less than 10, indicating no presence of
multicollinearity.

#### Homoscedasticity test

```{r}
bptest(model3) #Breusch-Pagan test

```

**Hypotheses**

$H_0$: The variance is homogeneous

$H_1$: The variance is not homogeneous

Significance level: 0.05

Test statistic: p-value = 0.6135

Decision: Since the p-value (0.6135) \> $\alpha$ (0.05), we fail to
reject $H_0$.

Conclusion: At the 95% confidence level, we conclude that the variance
is homogeneous (the homoscedasticity assumption is satisfied).

#### Autocorrelation Test

```{r}
bgtest(model3, order=3) #Breusch-Godfrey test 

```

The LM test statistic is 2.1293 with a p-value of 0.546 and 3 degrees of
freedom. The decision is to accept $H_0$, meaning that there is no
autocorrelation among the residuals at the 5% significance level.

### Conclusion

The best regression equation obtained in this study is: $$
\hat{Y}=80.8312−0.1990 X_3+0.1354 X_4−0.1104 X_6
$$ with

$\hat{Y}=$ Life expectancy prediction (years)

$X_3=$ Poverty rate (%)

$X_4=$ Complete immunization rate (%)

$X_6=$ Education index (unit)
